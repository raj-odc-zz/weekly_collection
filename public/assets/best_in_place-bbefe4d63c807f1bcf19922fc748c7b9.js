function BestInPlaceEditor(t){"use strict";this.element=t,this.initOptions(),this.bindForm(),this.initPlaceHolder(),jQuery(this.activator).bind("click",{editor:this},this.clickHandler)}!function(t){"use strict";var e,i={className:"autosizejs",id:"autosizejs",append:"\n",callback:!1,resizeDelay:10,placeholder:!0},a='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; padding: 0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>',n=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],s=t(a).data("autosize",!0)[0];s.style.lineHeight="99px","99px"===t(s).css("lineHeight")&&n.push("lineHeight"),s.style.lineHeight="",t.fn.autosize=function(a){return this.length?(a=t.extend({},i,a||{}),s.parentNode!==document.body&&t(document.body).append(s),this.each(function(){function i(){var e,i=window.getComputedStyle?window.getComputedStyle(h,null):!1;i?(e=h.getBoundingClientRect().width,(0===e||"number"!=typeof e)&&(e=parseInt(i.width,10)),t.each(["paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],function(t,a){e-=parseInt(i[a],10)})):e=m.width(),s.style.width=Math.max(e,0)+"px"}function r(){var r={};if(e=h,s.className=a.className,s.id=a.id,c=parseInt(m.css("maxHeight"),10),t.each(n,function(t,e){r[e]=m.css(e)}),t(s).css(r).attr("wrap",m.attr("wrap")),i(),window.chrome){var l=h.style.width;h.style.width="0px";{h.offsetWidth}h.style.width=l}}function l(){var t,n;e!==h?r():i(),s.value=!h.value&&a.placeholder?(m.attr("placeholder")||"")+a.append:h.value+a.append,s.style.overflowY=h.style.overflowY,n=parseInt(h.style.height,10),s.scrollTop=0,s.scrollTop=9e4,t=s.scrollTop,c&&t>c?(h.style.overflowY="scroll",t=c):(h.style.overflowY="hidden",u>t&&(t=u)),t+=p,n!==t&&(h.style.height=t+"px",f&&a.callback.call(h,h))}function o(){clearTimeout(d),d=setTimeout(function(){var t=m.width();t!==y&&(y=t,l())},parseInt(a.resizeDelay,10))}var c,u,d,h=this,m=t(h),p=0,f=t.isFunction(a.callback),b={height:h.style.height,overflow:h.style.overflow,overflowY:h.style.overflowY,wordWrap:h.style.wordWrap,resize:h.style.resize},y=m.width(),v=m.css("resize");m.data("autosize")||(m.data("autosize",!0),("border-box"===m.css("box-sizing")||"border-box"===m.css("-moz-box-sizing")||"border-box"===m.css("-webkit-box-sizing"))&&(p=m.outerHeight()-m.height()),u=Math.max(parseInt(m.css("minHeight"),10)-p||0,m.height()),m.css({overflow:"hidden",overflowY:"hidden",wordWrap:"break-word"}),"vertical"===v?m.css("resize","none"):"both"===v&&m.css("resize","horizontal"),"onpropertychange"in h?"oninput"in h?m.on("input.autosize keyup.autosize",l):m.on("propertychange.autosize",function(){"value"===event.propertyName&&l()}):m.on("input.autosize",l),a.resizeDelay!==!1&&t(window).on("resize.autosize",o),m.on("autosize.resize",l),m.on("autosize.resizeIncludeStyle",function(){e=null,l()}),m.on("autosize.destroy",function(){e=null,clearTimeout(d),t(window).off("resize",o),m.off("autosize").off(".autosize").css(b).removeData("autosize")}),l())})):this}}(window.jQuery||window.$),BestInPlaceEditor.prototype={activate:function(){"use strict";var t;if(this.isPlaceHolder())t="";else if(this.original_content)t=this.original_content;else switch(this.formType){case"input":case"textarea":if(this.display_raw)t=this.element.html().replace(/&amp;/gi,"&");else{var e=this.element.data("bipValue");t="undefined"==typeof e?"":"string"==typeof e?this.element.data("bipValue").replace(/&amp;/gi,"&"):this.element.data("bipValue")}break;case"select":t=this.element.html()}this.oldValue=this.isPlaceHolder()?"":this.element.html(),this.display_value=t,jQuery(this.activator).unbind("click",this.clickHandler),this.activateForm(),this.element.trigger(jQuery.Event("best_in_place:activate"))},abort:function(){"use strict";this.activateText(this.oldValue),jQuery(this.activator).bind("click",{editor:this},this.clickHandler),this.element.trigger(jQuery.Event("best_in_place:abort")),this.element.trigger(jQuery.Event("best_in_place:deactivate"))},abortIfConfirm:function(){"use strict";return this.useConfirm?void(confirm(BestInPlaceEditor.defaults.locales[""].confirmMessage)&&this.abort()):void this.abort()},update:function(){"use strict";var t=this,e=this.getValue();if(this.formType in{input:1,textarea:1}&&e===this.oldValue)return this.abort(),!0;switch(t.ajax({type:BestInPlaceEditor.defaults.ajaxMethod,dataType:BestInPlaceEditor.defaults.ajaxDataType,data:t.requestData(),success:function(e,i,a){t.loadSuccessCallback(e,i,a)},error:function(e,i){t.loadErrorCallback(e,i)}}),this.formType){case"select":this.previousCollectionValue=e,t.element.html(this.arrayToObject(this.values)[e]);break;case"checkbox":t.element.html(this.arrayToObject(this.values)[e]);break;default:""!==e?this.display_raw?t.element.html(e):t.element.text(e):t.element.html(this.placeHolder)}t.element.data("bipValue",e),t.element.trigger(jQuery.Event("best_in_place:update"))},activateForm:function(){"use strict";alert(BestInPlaceEditor.defaults.locales[""].uninitializedForm)},activateText:function(t){"use strict";this.element.html(t),this.isPlaceHolder()&&this.element.html(this.placeHolder)},initOptions:function(){"use strict";var t=this;t.element.parents().each(function(){var e=jQuery(this);t.url=t.url||e.data("bipUrl"),t.activator=t.activator||e.data("bipActivator"),t.okButton=t.okButton||e.data("bipOkButton"),t.okButtonClass=t.okButtonClass||e.data("bipOkButtonClass"),t.cancelButton=t.cancelButton||e.data("bipCancelButton"),t.cancelButtonClass=t.cancelButtonClass||e.data("bipCancelButtonClass")}),t.url=t.element.data("bipUrl")||t.url||document.location.pathname,t.collection=t.element.data("bipCollection")||t.collection,t.formType=t.element.data("bipType")||"input",t.objectName=t.element.data("bipObject")||t.objectName,t.attributeName=t.element.data("bipAttribute")||t.attributeName,t.activator=t.element.data("bipActivator")||t.element,t.okButton=t.element.data("bipOkButton")||t.okButton,t.okButtonClass=t.element.data("bipOkButtonClass")||t.okButtonClass||BestInPlaceEditor.defaults.okButtonClass,t.cancelButton=t.element.data("bipCancelButton")||t.cancelButton,t.cancelButtonClass=t.element.data("bipCancelButtonClass")||t.cancelButtonClass||BestInPlaceEditor.defaults.cancelButtonClass,t.placeHolder=null==t.element.data("bipPlaceholder")?BestInPlaceEditor.defaults.locales[""].placeHolder:t.element.data("bipPlaceholder"),t.inner_class=t.element.data("bipInnerClass"),t.html_attrs=t.element.data("bipHtmlAttrs"),t.original_content=t.element.data("bipOriginalContent")||t.original_content,t.display_raw=t.element.data("bip-raw"),t.useConfirm=t.element.data("bip-confirm"),("select"===t.formType||"checkbox"===t.formType)&&(t.values=t.collection,t.collectionValue=t.element.data("bipValue")||t.collectionValue)},bindForm:function(){"use strict";this.activateForm=BestInPlaceEditor.forms[this.formType].activateForm,this.getValue=BestInPlaceEditor.forms[this.formType].getValue},initPlaceHolder:function(){"use strict";""===this.element.html()&&this.element.html(this.placeHolder)},isPlaceHolder:function(){"use strict";return""===this.element.html()||this.element.html()===this.placeHolder},getValue:function(){"use strict";alert(BestInPlaceEditor.defaults.locales[""].uninitializedForm)},arrayToObject:function(t,e){if(null==t)return{};for(var i={},a=0,n=t.length;n>a;a++)e?i[t[a]]=e[a]:i[t[a][0]]=t[a][1];return i},sanitizeValue:function(t){"use strict";return jQuery.trim(t)},requestData:function(){"use strict";var t=jQuery("meta[name=csrf-token]").attr("content"),e=jQuery("meta[name=csrf-param]").attr("content"),i="_method="+BestInPlaceEditor.defaults.ajaxMethod;return i+="&"+this.objectName+"["+this.attributeName+"]="+encodeURIComponent(this.getValue()),void 0!==e&&void 0!==t&&(i+="&"+e+"="+encodeURIComponent(t)),i},ajax:function(t){"use strict";return t.url=this.url,t.beforeSend=function(t){t.setRequestHeader("Accept","application/json")},jQuery.ajax(t)},loadSuccessCallback:function(t,e,i){"use strict";if(t=jQuery.trim(t),this.original_content=this.display_raw?this.element.html():this.element.text(),t&&""!==t){var a=jQuery.parseJSON(t);null!==a&&a.hasOwnProperty("display_as")&&(this.element.data("bip-original-content",this.element.text()),this.element.html(a.display_as))}this.element.trigger(jQuery.Event("best_in_place:success"),[t,e,i]),this.element.trigger(jQuery.Event("ajax:success"),[t,e,i]),jQuery(this.activator).bind("click",{editor:this},this.clickHandler),this.element.trigger(jQuery.Event("best_in_place:deactivate")),null!==this.collectionValue&&"select"===this.formType&&(this.collectionValue=this.previousCollectionValue,this.previousCollectionValue=null)},loadErrorCallback:function(t,e){"use strict";this.activateText(this.oldValue),this.element.trigger(jQuery.Event("best_in_place:error"),[t,e]),this.element.trigger(jQuery.Event("ajax:error"),t,e),jQuery(this.activator).bind("click",{editor:this},this.clickHandler),this.element.trigger(jQuery.Event("best_in_place:deactivate"))},clickHandler:function(t){"use strict";t.preventDefault(),t.data.editor.activate()},setHtmlAttributes:function(){"use strict";var t=this.element.find(this.formType);if(this.html_attrs){var e=this.html_attrs;$.each(e,function(e,i){t.attr(e,i)})}},placeButtons:function(t,e){"use strict";e.okButton&&t.append(jQuery(document.createElement("input")).attr("type","submit").attr("class",e.okButtonClass).attr("value",e.okButton)),e.cancelButton&&t.append(jQuery(document.createElement("input")).attr("type","button").attr("class",e.cancelButtonClass).attr("value",e.cancelButton))}},BestInPlaceEditor.forms={input:{activateForm:function(){"use strict";var t=jQuery(document.createElement("form")).addClass("form_in_place").attr("action","javascript:void(0);").attr("style","display:inline"),e=jQuery(document.createElement("input")).attr("type","text").attr("name",this.attributeName).val(this.display_value);this.inner_class&&e.addClass(this.inner_class),t.append(e),this.placeButtons(t,this),this.element.html(t),this.setHtmlAttributes(),this.element.find("input[type='text']")[0].select(),this.element.find("form").bind("submit",{editor:this},BestInPlaceEditor.forms.input.submitHandler),this.cancelButton&&this.element.find("input[type='button']").bind("click",{editor:this},BestInPlaceEditor.forms.input.cancelButtonHandler),this.okButton||this.element.find("input[type='text']").bind("blur",{editor:this},BestInPlaceEditor.forms.input.inputBlurHandler),this.element.find("input[type='text']").bind("keyup",{editor:this},BestInPlaceEditor.forms.input.keyupHandler),this.blurTimer=null,this.userClicked=!1},getValue:function(){"use strict";return this.sanitizeValue(this.element.find("input").val())},inputBlurHandler:function(t){"use strict";t.data.editor.okButton?t.data.editor.blurTimer=setTimeout(function(){t.data.editor.userClicked||t.data.editor.abort()},500):t.data.editor.cancelButton?t.data.editor.blurTimer=setTimeout(function(){t.data.editor.userClicked||t.data.editor.update()},500):t.data.editor.update()},submitHandler:function(t){"use strict";t.data.editor.userClicked=!0,clearTimeout(t.data.editor.blurTimer),t.data.editor.update()},cancelButtonHandler:function(t){"use strict";t.data.editor.userClicked=!0,clearTimeout(t.data.editor.blurTimer),t.data.editor.abort(),t.stopPropagation()},keyupHandler:function(t){"use strict";27===t.keyCode&&(t.data.editor.abort(),t.stopImmediatePropagation())}},select:{activateForm:function(){"use strict";var t,e,i=jQuery(document.createElement("form")).attr("action","javascript:void(0)").attr("style","display:inline"),a=jQuery(document.createElement("select")).attr("class",null!==this.inner_class?this.inner_class:""),n=this.collectionValue,s=this.arrayToObject(this.values);for(t in s){e=s[t];var r=jQuery(document.createElement("option")).val(t).html(e);String(t)===String(n)&&r.attr("selected","selected"),a.append(r)}i.append(a),this.element.html(i),this.setHtmlAttributes(),this.element.find("select").bind("change",{editor:this},BestInPlaceEditor.forms.select.blurHandler),this.element.find("select").bind("blur",{editor:this},BestInPlaceEditor.forms.select.blurHandler),this.element.find("select").bind("keyup",{editor:this},BestInPlaceEditor.forms.select.keyupHandler),this.element.find("select")[0].focus();try{var l=document.createEvent("MouseEvents");l.initMouseEvent("mousedown",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),this.element.find("select")[0].dispatchEvent(l)}catch(l){}},getValue:function(){"use strict";return this.sanitizeValue(this.element.find("select").val())},blurHandler:function(t){"use strict";t.data.editor.update()},keyupHandler:function(t){"use strict";27===t.keyCode&&t.data.editor.abort()}},checkbox:{activateForm:function(){"use strict";this.collectionValue=!this.getValue(),this.setHtmlAttributes(),this.update()},getValue:function(){"use strict";return this.collectionValue}},textarea:{activateForm:function(){"use strict";var t=this.element.css("width"),e=this.element.css("height"),i=jQuery(document.createElement("form")).addClass("form_in_place").attr("action","javascript:void(0);").attr("style","display:inline"),a=jQuery(document.createElement("textarea")).attr("name",this.attributeName).val(this.sanitizeValue(this.display_value));null!==this.inner_class&&a.addClass(this.inner_class),i.append(a),this.placeButtons(i,this),this.element.html(i),this.setHtmlAttributes(),jQuery(this.element.find("textarea")[0]).css({"min-width":t,"min-height":e}),jQuery(this.element.find("textarea")[0]).autosize(),this.element.find("textarea")[0].focus(),this.element.find("form").bind("submit",{editor:this},BestInPlaceEditor.forms.textarea.submitHandler),this.cancelButton&&this.element.find("input[type='button']").bind("click",{editor:this},BestInPlaceEditor.forms.textarea.cancelButtonHandler),this.element.find("textarea").bind("blur",{editor:this},BestInPlaceEditor.forms.textarea.blurHandler),this.element.find("textarea").bind("keyup",{editor:this},BestInPlaceEditor.forms.textarea.keyupHandler),this.blurTimer=null,this.userClicked=!1},getValue:function(){"use strict";return this.sanitizeValue(this.element.find("textarea").val())},blurHandler:function(t){"use strict";t.data.editor.okButton?t.data.editor.blurTimer=setTimeout(function(){t.data.editor.userClicked||t.data.editor.abortIfConfirm()},500):t.data.editor.cancelButton?t.data.editor.blurTimer=setTimeout(function(){t.data.editor.userClicked||t.data.editor.update()},500):t.data.editor.update()},submitHandler:function(t){"use strict";t.data.editor.userClicked=!0,clearTimeout(t.data.editor.blurTimer),t.data.editor.update()},cancelButtonHandler:function(t){"use strict";t.data.editor.userClicked=!0,clearTimeout(t.data.editor.blurTimer),t.data.editor.abortIfConfirm(),t.stopPropagation()},keyupHandler:function(t){"use strict";27===t.keyCode&&t.data.editor.abortIfConfirm()}}},BestInPlaceEditor.defaults={locales:{},ajaxMethod:"put",ajaxDataType:"text",okButtonClass:"",cancelButtonClass:""},BestInPlaceEditor.defaults.locales[""]={confirmMessage:"Are you sure you want to discard your changes?",uninitializedForm:"The form was not properly initialized. getValue is unbound",placeHolder:"-"},jQuery.fn.best_in_place=function(){"use strict";function t(t){return t.data("bestInPlaceEditor")?void 0:(t.data("bestInPlaceEditor",new BestInPlaceEditor(t)),!0)}return jQuery(this.context).delegate(this.selector,"click",function(){var e=jQuery(this);t(e)&&e.click()}),this.each(function(){t(jQuery(this))}),this};